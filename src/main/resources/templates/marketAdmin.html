<!doctype html>
<html>

<head>
    <link href="../css/styles.css" rel="stylesheet" />
    <head th:include="fragments/headerLogged :: head"></head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Market Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.4/dist/axios.min.js"></script>

</head>

<body>
<nav th:replace="fragments/headerLogged :: navbar"></nav>

<div id="app">
    <span class="userHomeTitle">Market list</span>

    <div class="frameContainerR">
        <div class="marketItem" v-for="market in markets" :key="market.id">
            <div class="orderNum">Venue #{{ market.id }}</div>
            <div class="marketStall">{{ market.name }}</div>
<!--            <div class="dateAddress">Crown St, Surry Hills NSW 2010 </div>-->
            <button type="button" class="marketReview" @click="openREForm(market)">View or Edit Market Detail</button>
            <br>
            <div class="userline"></div>
        </div>
    </div>

    <div class="blackLayer" v-show="showFormLayer"></div>

    <div class="reviewM-popup" v-show="showReviewForm">
        <button type="button" class="btn cancel" @click="closeREForm">x</button>
        <br><span>Venue #{{ currentMarket.id }}</span><br>
        <span>Venue name: {{ currentMarket.name }}</span><br>
        <span>Venue address: {{ currentMarket.address }}</span><br>
        <span>Venue suburb: {{ currentMarket.suburb }}</span><br>
        <span>Total Stall: {{ currentMarket.stall }}</span>
    </div>
</div>

<div th:replace="fragments/footer :: footer"></div>

<script>
    new Vue({
        el: '#app',
        data: {
            markets:[],
            currentMarket: {},
            showReviewForm: false,
            showFormLayer: false,
        },
        methods: {
            getMarkets() {
                axios.get('/api/venues') // Make sure the URL is correct
                    .then(response => {
                        this.markets = response.data;
                    })
                    .catch(error => {
                        if (error.response) {
                            console.error("Error Data:", error.response.data);
                        }
                        console.error("Error fetching data:", error);
                    });
            },
            openREForm: function(market) {  // 添加参数
                this.currentMarket = market;  // 保存当前的market
                this.showReviewForm = true;
                this.showFormLayer = true;
            },
            closeREForm: function() {
                this.showReviewForm = false;
                this.showFormLayer = false;
            }
        },
        mounted() {
            this.getMarkets();
        }
    });
</script>

</body>

</html>