<!doctype html>
<html>
<head>
    <head th:include="fragments/header :: head"></head>
    <link href="../css/styles.css" rel="stylesheet" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Register Success Page</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@0.21.4/dist/axios.min.js"></script>

    <style>
        body {
            background-color: gray;
        }
    </style>
</head>
<body>
<nav th:replace="fragments/header :: navbar"></nav>

<div id="app">
    <div class="indexContent">
    </div>
    <div class="loginFormDiv" style="top:28%">
        <div class="loginForm">
            <span class="RStext">Thank you for registering in our website! If you are registered as stall holder, you may login to your account now! If you are registed as marker organizer, there will be an approval process to confirm your given information to keep our customers safe. The approximate time of approval will be 1-5 business days. A notification will be sent to you if your registration gets approved.  Thank you for your collaboration!</span>

            <button class="btn" @click="goToLogin" style="top:80%">OK</button>
        </div>



    </div>
</div>
<div th:replace="fragments/footer :: footer"></div>


<script>
    new Vue({
        el: '#app',
        data: {
            showSHForm: false,
            showMOForm: false,
            showFormLayer: false,
            passwordsMatch: null


        },
        methods: {
            goToLogin() {
                window.location.href = '/login';
            },
            validatePasswords: function() {
                const form = this.showSHForm ? document.querySelector('.SHform-popup .form-container') : document.querySelector('.MOform-popup .form-container');
                const formData = new FormData(form);
                const password = formData.get('psw');
                const confirmPassword = formData.get('psw2');

                this.passwordsMatch = (password === confirmPassword);
            },
            registerSH: function() {
                const form = document.querySelector('.SHform-popup .form-container');
                const formData = new FormData(form);

                const firstName = formData.get('firstName');
                const lastName = formData.get('lastName');
                const phoneNum = formData.get('phoneNum');
                const email = formData.get('email');
                const password = formData.get('psw');

                const type = 'owner';

                const apiUrl = `/api/users/register?firstName=${firstName}&lastName=${lastName}&phone=${phoneNum}&email=${email}&password=${password}&type=${type}`;

                axios.post(apiUrl)
                    .then(response => {
                        alert('Registration successful! You may login your account now!');
                        location.reload();
                    })
                    .catch(error => {
                        console.error('Error updating user information:', error);
                    });
            },
            registerMO: function() {
                const form = document.querySelector('.MOform-popup .form-container');
                const formData = new FormData(form);

                const firstName = formData.get('firstName');
                const lastName = formData.get('lastName');
                const phoneNum = formData.get('phoneNum');
                const email = formData.get('email');
                const password = formData.get('psw');

                const type = 'organiser';

                const apiUrl = `/api/users/register?firstName=${firstName}&lastName=${lastName}&phone=${phoneNum}&email=${email}&password=${password}&type=${type}`;

                axios.post(apiUrl)
                    .then(response => {
                        alert('Thank you for registering in our website! To keep our customers safe, there will be an approval process to confirm your given information. The approximate time of approval will be 1-5 business days. A notification will be sent to you if your registration gets approved.  Thank you for your collaboration!');
                        window.location.href = '/';
                    })
                    .catch(error => {
                        console.error('Error updating user information:', error);
                    });
            },
            handleLogin: function() {
                let formData = new FormData(document.querySelector('.loginForm'));

                axios.post('/login', formData)
                    .then((response) => {
                        let data = response.data;
                        if (data.status && data.status === "error") {
                            alert("Invalid username or password");
                            return;
                        }

                        if (data.status !== 'error') {
                            localStorage.setItem('isLoggedIn', 'true');
                            localStorage.setItem('userType', data.userType);
                        } else {
                            localStorage.setItem('isLoggedIn', 'false');
                        }

                        switch(data.userType) {
                            case "owner":
                                window.location.href = "/uhome";
                                break;
                            case "organiser":
                                window.location.href = "/ohome";
                                break;
                            case "admin":
                                window.location.href = "/ahome";
                                break;
                            default:
                                alert("Unknown user type");
                                break;
                        }
                    })
                    .catch((error) => {
                        console.error("Error during login:", error);
                        alert("There was an error during login");
                    });
            },
            openSHForm: function() {
                this.showSHForm = true;
                this.showFormLayer = true;

            },
            closeSHForm: function() {
                this.showSHForm = false;
                this.showFormLayer = false;
            },
            openMOForm: function() {
                this.showMOForm = true;
                this.showFormLayer = true;
            },
            closeMOForm: function() {
                this.showMOForm = false;
                this.showFormLayer = false;
            }
        }
    });
</script>
</body>
</html>
